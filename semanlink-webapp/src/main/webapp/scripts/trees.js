// sur une base de longwell pour le fonctionnement des arbres// avec du XMLHttpRequest pour son chargement.// suppose definie la fct liveTreeLoadSubTree() qui retourne quelque chose genre :// "http://127.0.0.1:8080/semanlink/loadsubtree.do" @see template.jsp// author fps// sert a avoir la bonne image (ouvert/ferme)function makeConsistent(id,element) {	var trigger = document.getElementById("trigger:" + id);	if (trigger) {	    if ((element.style.display != "none") && (trigger.src.indexOf('closed') > -1)) {	        trigger.src = trigger.src.replace(/closed/gi,"open");	    } else if ((element.style.display == "none") && (trigger.src.indexOf('open') > -1)) {	        trigger.src = trigger.src.replace(/open/gi,"closed");	    }	}}function toggle(id) {    var block = document.getElementById("block:" + id);	if (block.innerHTML == "") {		// alert("load the subtree");		// block.innerHTML = "<li>aaaa</li><li>bbb</b>";		// block.innerHTML = retrieveURL(urlToRetrieve.value)	} else {		with (block.style) {			if (display=="none") {				display="block";			} else {				display="none";			}		}	}    // sert a avoir la bonne image (ouvert/ferme)	makeConsistent(id,block);}// pour un livetree// param id par ex 1_1_2// param encodedId l'uri du kw, encodee// postTagOnClick true si le href doit avoir un onclick avec un post pour cas du pulldown du livesearch en edit=true// targetUri : 2020-02 TagAndTagfunction toggle2(id, encodedId, withDocs, postTagOnClick, targetUri) {    var block = document.getElementById("block:" + id);	if (!block) { // the subtree has not been downloaded yet		// alert("load the subtree" + encodedId);		// ci-dessous : le & devrait etre encode, non ?		var arg = liveTreeLoadSubTree() + "?kwuri=" + encodedId +'&divid=' + id;		if (withDocs == 'true') arg = arg + "&withdocs=true";		if (postTagOnClick == 'true') arg = arg + "&postTagOnClick=true";		if (targetUri) arg = arg + "&targeturi=" + encodeURIComponent(targetUri);		retrieveURL(arg , id); // debug ok	} else {		with (block.style) {			if (display=="none") {				display="block";			} else {				display="none";			}		}	    // sert a avoir la bonne image (ouvert/ferme)		makeConsistent(id,block);	}}var searchStr = "";////   AJAX POUR LE LIVETREE DEBUT//var req;var theId;var isIE=false;// why asynchronous calls? Would have been much easier using synchronous calls.// see toggle2function retrieveURL(url, id) {	// alert(url);	theId = id;	if (window.XMLHttpRequest) { // Non-IE browsers		req = new XMLHttpRequest();		req.onreadystatechange = processStateChange;		try {			req.open("GET", url, true);		} catch (e) {			alert(e);		}	  req.send(null);	} else if (window.ActiveXObject) { // IE		isIE = true;		req = new ActiveXObject("Microsoft.XMLHTTP");		if (req) {			req.onreadystatechange = processStateChange;			req.open("GET", url, true);			req.send();		}	}}function processStateChange() {	if (req.readyState == 4) { // Complete	  if (req.status == 200) { // OK response		  		var item = document.getElementById('trigger:' + theId);		if (!item) {			alert("That's unexpected: item not found " + theId);			return;		}		// we add the returned data to the innerHTML 		// of the containing line 		var mother_li = mother_li = item.parentNode;		var innerli = mother_li.innerHTML;		innerli += '<ul id="block:' +theId+ '" class="livetree">';		innerli += req.responseText;		innerli += '</ul>';		mother_li.innerHTML = innerli;			    // sert a avoir la bonne image (ouvert/ferme)		var block = document.getElementById("block:" + theId);		makeConsistent(theId,block);		// highlight: used by livesearch. Set by an id ("LSHighlight") on the line		var highlight = document.getElementById("LSHighlight");		if (highlight) {			// le changer			highlight.removeAttribute("id"); // set the hilite to false			son = highlight.firstChild.nextSibling.nextSibling.firstChild;			if (!isIE) {				highlight = son.nextSibling;			} else {				highlight = son;			}			highlight.setAttribute("id","LSHighlight");		}				displayCommentAsMarkdown() // 2019-09	  } else {		alert("Problem: " + req.statusText);	  }	}}  ////   AJAX POUR LE LIVETREE FIN//  ////////////////////////////////////////////// ceci n'a rien a voir avec les scripts precedents, juste mis là par paresse// LOAD IMAGEfunction loadImage(imageUri, imageLinkToPage) {	var img = document.getElementById("displayedimage");	img.src = imageUri;	var panel = document.getElementById("imagetobedisplayedpanel");	panel.style.display="block";	// ce qui suit est ok avec safari : on tombe sur le href. Mais avec firefox, prend le commentaire entre deux	// panel.firstChild.setAttribute("href",imageLinkToPage);	var theHref = document.getElementById("displayedimagehref");	theHref.setAttribute("href",imageLinkToPage);}function printVersion() { // 2020-01	displayRightBar(false);    var d = document.getElementById("logo");    if (d) {        d.style.display = "none";    }}function printVersion_TOBEDELETED() {	var d = false;	d = document.getElementById("right");	if (d) {		d.style.display = "none";	}	d = document.getElementById("navcontainer");	if (d) {		d.style.display = "none";	}	d = document.getElementById("logo");	if (d) {		d.style.display = "none";	}	d = document.getElementById("file_info")	if (d) {		d.style.display = "none";	}	d = document.getElementById("aboutThisDoc")	if (d) {		d.style.display = "none";	}	d = document.getElementById("documenttags")	if (d) {		d.style.display = "none";	}	d = document.getElementById("middle")	if (d) {		d.id = "middleprint";	}}//// DRAG'N DROP////function allowDrop(ev) {//	ev.preventDefault();//}////function onDragStart(ev) {//	alert("dragstart " + JSON.stringify(ev));//  // ev.dataTransfer.setData("text", ev.target.id);//}//////function drag(ev) {//	alert("drag " + ev);//  // ev.dataTransfer.setData("text", ev.target.id);//}function drop(ev) {//	alert("drop " + JSON.stringify(ev.dataTransfer));//	alert("drop" + JSON.stringify(ev.dataTransfer.getData("text/plain") ))		var href = ev.dataTransfer.getData("text");	if (href) {		var textLink = false;		// not ok if draggué à partir d'un checkbox		var els = document.querySelectorAll("a[href='" + href + "']");				if (els.length > 0) {			textLink = els[0].innerHTML;		} else { // for the case we have dragged something which is not a link from tag list			var k = href.lastIndexOf("/");			if (k > 0) {				textLink = href.substring(k+1);			} else {				if (href.startsWith("http")) {					textLink = href;				}						}				}		if (textLink) {			setTimeout(() => dropLink(ev.target, href, textLink), 0);					}	}}function dropLink(target, href, linkText) {	var text = target.value;	var con = window.location.protocol + '//' + window.location.host + getContextPath();	shortHref = href.replace(con,"");	text = text.replace(href, "[" + linkText + "](" + shortHref + ")");	target.value = text;}//function dragend(ev) {//////	alert("drop " + JSON.stringify(ev.dataTransfer));//////	alert("drop" + JSON.stringify(ev.dataTransfer.getData("text/plain") ))////	////	var href = ev.dataTransfer.getData("text");////	// not ok if draggué à partir d'un checkbox////	var els = document.querySelectorAll("a[href='" + href + "']");////	var textLink = els[0].innerHTML;////	alert("dragend " + textLink + " : " + href + " xxx " + ev.target.value);//////	ev.preventDefault();//////	var data = ev.dataTransfer.getData("text");//////	ev.target.appendChild(document.getElementById(data));//	alert("dragend");//}