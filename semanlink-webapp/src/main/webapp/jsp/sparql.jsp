<%@ page    contentType="text/html;charset=UTF-8"  pageEncoding="UTF-8" language="java" session="false" import="net.semanlink.util.*,net.semanlink.servlet.*,net.semanlink.skos.SKOS"%><style type="text/css"><!--.kod {	font-family: "Courier New", Courier, mono;	font-size: 12px;	background-color: #FFFFCC;	border: thin solid;	margin-right: 80px;	margin-left: 80px;	margin-bottom: 12px;	margin-top: 12px;}.kod p {	margin-top: 2px;	margin-bottom: 2px;}--></style><%/* It seems that we need to encode the query twice if we want it to work when it contains diacritics. So, - if we use windows.location = url, we must call encodeURIComponent twice. - if we use the content of a GET form field, we must encode it once with encodeURIComponent, the  form enconding it once more  sparql as rdf: the servlet calls the SPARQLEndpoint, which decodes once the "query" parameter of the request  sparql as html: the servlet get the "query" param, encode it, and pass it to the html page that loads rdf, where it is written as in in the "onload" on the body tag  But in fact, a single encoding works IF we do not use diacritics (decoding twice something encoding only one is no problem) That is, we can encode only once IF we encode the diacritics - that is, if we write "%C3%A9" instead of "Ã©" in an input field. */String contextURL =  Util.getContextURL(request);String sparqlURL = contextURL + "/sl/sparql/";%><div class="graybox"><p><b>Examples</b></p><p>You can use the "http://www.semanlink.net/2001/00/semanlink-schema#tagText" "magic" property to search for a tag using a partial string (same behavior as the "SEARCH TAG" form in the GUI)</p><form action="#" method="get" id="formOfButtons">	<p>		<input type="button" value="Tags by text" onclick="chooseSparqlExample('ex7') ; return false;" />		<input type="button" value="Docs with tag 'RDF' (strict match)" onclick="chooseSparqlExample('ex3') ; return false;" />	</p><p>Subtrees</p><p>		<input type="button" value="Tags descendants of tag:linked_data" onclick="chooseSparqlExample('ex2bis') ; return false;" />		<input type="button" value="Docs with tag:linked_data (or its descendants)" onclick="chooseSparqlExample('ex4bis') ; return false;" />		<br/>		<input type="button" value="Tags descendants of both tag:archeologie and tag:afrique" onclick="chooseSparqlExample('ex5bis') ; return false;" />		<input type="button" value="Docs with tag:archeologie and tag:afrique (or their descendants)" onclick="chooseSparqlExample('ex6bis') ; return false;" />	</p><p>		<input type="button" value="Tags 'narrower' of tag:music_of_africa" onclick="chooseSparqlExample('ex8') ; return false;" />		<input type="button" value="Tags 'narrowerTransitive' of tag:music_of_africa" onclick="chooseSparqlExample('ex9') ; return false;" />		<input type="button" value="Docs with tag:music_of_africa (or its 'narrowerTransitive')" onclick="chooseSparqlExample('ex10') ; return false;" />	</p><p>Intersecting SKOS subtrees: eg. when searching "archeology AND Africa", we get documents tagged with "Tutankhamun", and documents tagged with "rockart" and "Niger"</p><p>			<input type="button" value="Tags 'narrowerTransitive' of both tag:archeologie and tag:afrique" onclick="chooseSparqlExample('ex11') ; return false;" />		<input type="button" value="Docs with tag:archeologie and tag:afrique" onclick="chooseSparqlExample('ex12') ; return false;" />		<input type="button" value="Docs tagged 'archeo' and 'Africa'" onclick="chooseSparqlExample('ex13') ; return false;" />	</p></form><div style="display:none"><p><b>Prefixes:</b></p><form action="#" id="prefixesForm"><p><textarea name="prefixes" cols="80" rows="3"></textarea></p></form></div><%String oldQuery = request.getParameter("query");if (oldQuery == null) oldQuery = "";   // This is not the form used to submit the query%><p><b>Query:</b></p><form action="#" method="get" id="sparqlInputForm">	<p><textarea name="q" cols="80" rows="8"><%=oldQuery%></textarea></p></form><% // THE FORM THAT IS ACTUALLY USED TO SUBMIT THE QUERY:    // THE 2 "RDF" AND "HTML" BTNS, AND A HIDDEN "query" FIELD %> 	<form id="sparqlSubmitQueryForm" action="<%=sparqlURL%>" method="get" >        <p><b>Execute:</b></p><p>        <input type="hidden" name="query" value="" />        <input type="hidden" name="as" value="" />        <input type="button" value="XML" onclick="prepareSparqlQuery() ; asWhat('rdf') ; ; submit()"/>        for DESCRIBE or CONSTRUCT queries only: <input type="button" value="RDF/N3" onclick="prepareSparqlQuery() ; asWhat('n3') ; ; submit()"/>        <input type="button" value="HTML" onclick="prepareSparqlQuery() ; asWhat('html') ; submit()"/>		</p>	</form><% // ONE BUTTON FOR EACH OF THE PREPARED EXAMPLES    // AND THE TEXTAREA   // This is not the form used to submit the query%><div style="display:none"><form id="sparqlExamples" action="" method="get"><%/*ATTENTIONas of 2010-06, due to a bug in ARQ, evaluation of property paths can be very slow,hence the use of descendant or ancestor, depending on the caseSEE http://tech.groups.yahoo.com/group/jena-dev/message/44213(SOLVED NOW)*/// PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;// PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;%><textarea id="ex2" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	?tag sl:hasAncestor tag:linked_data.}</textarea><textarea id="ex2bis" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	?tag skos:broader* tag:linked_data.}</textarea><textarea id="ex3" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;DESCRIBE ?doc WHERE {	{?tag skos:prefLabel "RDF"@en} UNION {?tag skos:prefLabel "RDF"@fr} UNION {?tag skos:prefLabel "RDF"}	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; { 		?doc sl:tag ?tag.	}}</textarea><textarea id="ex4" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?doc WHERE {	?tag sl:hasAncestor tag:linked_data.	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; { 		?doc sl:tag ?tag.	}}</textarea><textarea id="ex4bis" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?doc WHERE {	?tag skos:broader* tag:linked_data.	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; { 		?doc sl:tag ?tag.	}}</textarea><textarea id="ex5" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	?tag sl:hasAncestor tag:archeologie.	?tag sl:hasAncestor tag:afrique.}</textarea><textarea id="ex5bis" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	?tag skos:broader* tag:archeologie.	?tag skos:broader* tag:afrique.}</textarea><textarea id="ex6" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?doc WHERE {	?tag sl:hasAncestor tag:archeologie.	?tag2 sl:hasAncestor tag:afrique.	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; {		?doc sl:tag ?tag.		?doc sl:tag ?tag2.	}}</textarea><textarea id="ex6bis" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?doc WHERE {	?tag skos:broader* tag:archeologie.	?tag2 skos:broader* tag:afrique.	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; {		?doc sl:tag ?tag.		?doc sl:tag ?tag2.	}}</textarea><textarea id="ex7" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	?tag sl:tagText "link DAT".}</textarea><textarea id="ex8" rows="8" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	tag:music_of_africa skos:narrower ?tag.}</textarea><textarea id="ex9" rows="8" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	tag:music_of_africa skos:narrowerTransitive ?tag.}</textarea><textarea id="ex10" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?doc WHERE {	tag:music_of_africa skos:narrowerTransitive ?tag.	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; { 		?doc sl:tag ?tag.	}}</textarea><textarea id="ex11" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?tag WHERE {	?tag skos:broaderTransitive tag:archeologie.	?tag skos:broaderTransitive tag:afrique.}</textarea><textarea id="ex12" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?doc WHERE {	?tag skos:broaderTransitive tag:archeologie.	?tag2 skos:broaderTransitive tag:afrique.	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; {		?doc sl:tag ?tag.		?doc sl:tag ?tag2.	}}</textarea><textarea id="ex13" rows="4" cols="60">PREFIX sl: &lt;http://www.semanlink.net/2001/00/semanlink-schema#&gt; PREFIX tag: &lt;<%=SLServlet.getSLModel().getDefaultThesaurus().getBase()%>&gt; PREFIX skos: &lt;<%=SKOS.NS%>&gt;DESCRIBE ?doc WHERE {	?tagByText sl:tagText "archeo".	?tagByText2 sl:tagText "Africa".	?tag skos:broaderTransitive ?tagByText.	?tag2 skos:broaderTransitive ?tagByText2.	GRAPH &lt;<%=SLServlet.getServletUrl() + "/docs/"%>&gt; {		?doc sl:tag ?tag, ?tag2.	}}</textarea><%/*PREFIX tag: <http://www.semanlink.net/tag/> 	PREFIX sl: <http://www.semanlink.net/2001/00/semanlink-schema#> 	PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>	PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>	DESCRIBE ?tag ?doc WHERE {	?tag sl:hasParent* tag:antiquite.	?tag sl:hasParent* tag:afrique.	GRAPH <http://127.0.0.1/semanlink/docs/> {	?doc sl:tag ?tag.	}	}	*/	/*		// pas nok ?PREFIX tag: <http://www.semanlink.net/tag/> PREFIX sl: <http://www.semanlink.net/2001/00/semanlink-schema#> PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>SELECT ?doc WHERE {tag:antiquite ^sl:hasParent* ?tag.tag:afrique ^sl:hasParent* ?tag2.GRAPH <http://127.0.0.1/semanlink/docs/> {?doc ?p ?tag.?doc ?p ?tag2}}*/%></form></div> <% // hidden div containing the prepared examples %><script type="text/javascript">		<% // put the example into the textarea (where we enter a query). %>	function chooseSparqlExample(exampleId) {		document.getElementById('sparqlInputForm').q.value = document.getElementById("prefixesForm").prefixes.value 		+ document.getElementById(exampleId).value;		document.getElementById('results').style.display = "none";	}	<%	// prepare and put actual request into the form that is submitted to execute the query	/** @param textAreaFormId id of form containing the textArea with input of query's body. Must contain a textarea called q	  * @param formId id of actual form containg the submit button. Must contain an input text called query*/	%>	function prepareSparqlQuery() { 		/*document.getElementById('sparqlSubmitQueryForm').query.value = encodeURIComponent(			document.getElementById("sparqlInputForm").q.value		);*/		document.getElementById('sparqlSubmitQueryForm').query.value = 			document.getElementById("sparqlInputForm").q.value		;		/*		document.getElementById('output').q.value = encodeURIComponent(			document.getElementById("sparqlInputForm").q.value		);*/			}	function asWhat(what) {		document.getElementById('sparqlSubmitQueryForm').as.value = what;	}</script></div><%// on affiche la div des results seulement ds le cas if (oldQuery.toUpperCase().indexOf("DESCRIBE") > -1) { %><div id="results"><%} else  {%><div id="results" style="display:none"><%} %><h1>RESULTS</h1><div id="sparqlresults"></div></div>