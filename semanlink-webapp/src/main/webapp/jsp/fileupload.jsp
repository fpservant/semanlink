<!--fileupload.jsp--><%/** @since 2020-09 to upload file with drag'n drop */%><%@ page language="java" session="true" import="net.semanlink.servlet.*,net.semanlink.semanlink.*,net.semanlink.util.*, java.util.*, java.io.*"%><%@ taglib uri="http://struts.apache.org/tags-bean" prefix="bean" %><%@ taglib uri="http://struts.apache.org/tags-html" prefix="html" %><%@ taglib uri="http://struts.apache.org/tags-logic" prefix="logic" %><%Jsp_Document jsp = (Jsp_Document) request.getAttribute("net.semanlink.servlet.jsp");SLDocument x = (SLDocument) jsp.getSLResource();String uri = x.getURI();%>        <script>            window.onload = function() {                var dropbox = document.getElementById("dropbox");                dropbox.addEventListener("dragenter", noop, false);                dropbox.addEventListener("dragexit", noop, false);                dropbox.addEventListener("dragover", noop, false);                dropbox.addEventListener("drop", dropUpload, false);            }            function noop(event) {                event.stopPropagation();                event.preventDefault();            }            function dropUpload(event) {                noop(event);                var files = event.dataTransfer.files;                for (var i = 0; i < files.length; i++) {                    upload(files[i]);                }            }            function upload(file) {                document.getElementById("status").innerHTML = "Uploading " + file.name;                var formData = new FormData();                formData.append("file", file);                alert(document.getElementById("sub_dir").value);                formData.append("sub_dir", document.getElementById("sub_dir").value);                var xhr = new XMLHttpRequest();                xhr.upload.addEventListener("progress", uploadProgress, false);                xhr.addEventListener("load", uploadComplete, false);                // 2020-09 TODO                xhr.open("POST", getContextPath() + "/sl/upload", true); // If async=false, then you'll miss progress bar support.                xhr.send(formData);            }            function uploadProgress(event) {                // Note: doesn't work with async=false.                var progress = Math.round(event.loaded / event.total * 100);                document.getElementById("status").innerHTML = "Progress " + progress + "%";            }            function uploadComplete(event) {                document.getElementById("status").innerHTML = event.target.responseText;            }        </script>        <style>            #dropbox {                width: 300px;                height: 20px;                border: 1px solid gray;                border-radius: 5px;                padding: 5px;                color: gray;            }        </style>             <div id="dropbox">Drag and drop a file here...</div>        <p>To dir:<textarea id="sub_dir"></textarea></p>        <div id="status"></div>        <!--/fileupload.jsp-->