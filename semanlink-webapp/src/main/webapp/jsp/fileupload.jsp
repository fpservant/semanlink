<!--fileupload.jsp--><%/** @since 2020-09 to upload file with drag'n drop */%><%@ page language="java" session="true" import="net.semanlink.servlet.*,net.semanlink.semanlink.*,net.semanlink.util.*, java.util.*, java.io.*"%><%@ taglib uri="http://struts.apache.org/tags-bean" prefix="bean" %><%@ taglib uri="http://struts.apache.org/tags-html" prefix="html" %><%@ taglib uri="http://struts.apache.org/tags-logic" prefix="logic" %><%Jsp_Document jsp = (Jsp_Document) request.getAttribute("net.semanlink.servlet.jsp");SLDocument x = (SLDocument) jsp.getSLResource();String uri = x.getURI();%>        <script>            /*            var files = false;                        window.onload = function() {                var dropbox = document.getElementById("dropbox");                dropbox.addEventListener("dragenter", noop, false);                dropbox.addEventListener("dragexit", noop, false);                dropbox.addEventListener("dragover", noop, false);                dropbox.addEventListener("drop", dropUpload, false);            }            function noop(event) {                event.stopPropagation();                event.preventDefault();            }            function dropUpload(event) {                noop(event);                files = event.dataTransfer.files;                                                var dropbox = document.getElementById("dropbox");                var fns = ""                for (var i = 0; i < files.length; i++) {                    // upload(files[i]);                    fns += files[i].name                    fns += "\n";                }                dropbox.innerHTML = fns;            }            function uploadFiles() {            	if (!files) {            		alert("No file to upload")            	}                for (var i = 0; i < files.length; i++) {                    upload(files[i]);                }            }            */                        function uploadFiles() {            	files = document.getElementById('theFile').files;                if (!files) {                    alert("No file to upload")                }                /*for (var i = 0; i < files.length; i++) {                    upload(files[i]);                }*/                upload(files[0]);            }                                    function uploadDirUri() {            	return '<%=uri%>';            }                        function extension(filename) {            	var re = /(?:\.([^.]+))?$/;            	return re.exec(filename)[1];            }                        function upload(file) {                var formData = new FormData();                var type = file.type;                                var createDir = false;                if (!type) {                    var ext = extension(file.name);                    if (!ext) {                    	createDir = true;	                	// alert("Folders not supported");	                	// return;	                    formData.append("createSubDir", file.name);	                    document.getElementById("status").innerHTML = "Creating sub dir " + file.name;                    }                }                if (!createDir) {                	// alert("type: " + type)                    formData.append("file", file);                    document.getElementById("status").innerHTML = "Uploading " + file.name;                }                // document.getElementById("status").innerHTML = "Uploading " + file.name;                                formData.append("uploadDirUri", uploadDirUri());                // alert(document.getElementById("sub_dir").value);                // formData.append("sub_dir", document.getElementById("sub_dir").value);                var xhr = new XMLHttpRequest();                xhr.upload.addEventListener("progress", uploadProgress, false);                xhr.addEventListener("load", uploadComplete, false);                // 2020-09 TODO                xhr.open("POST", getContextPath() + "/sl/upload", true); // If async=false, then you'll miss progress bar support.                xhr.send(formData);            }            function uploadProgress(event) {                // Note: doesn't work with async=false.                var progress = Math.round(event.loaded / event.total * 100);                document.getElementById("status").innerHTML = "Progress " + progress + "%";            }            function uploadComplete(event) {                // alert("uploadComplete " + event.target.status);                if (event.target.status == 200) {                	window.location.href = '<%=uri%>';                } else {                    document.getElementById("status").innerHTML = event.target.responseText;                	                }            }        </script>        <style>            #dropbox {                /* width: 100%; 300px;*/                height: 18px;                border: 1px solid lightgray;                border-radius: 5px;                padding: 5px;                color: gray;            }        </style><div class="graybox"><p><b>File Upload</b></p>        <input type="file" name="file1" id="theFile">        <div id="status"></div>        <button onclick="uploadFiles()">Upload</button></div>       <!--/fileupload.jsp-->