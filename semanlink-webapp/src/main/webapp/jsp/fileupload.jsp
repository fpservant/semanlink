<!--fileupload.jsp--><%/** @since 2020-09 to upload file with drag'n drop */%><%@ page language="java" session="true" import="net.semanlink.servlet.*,net.semanlink.semanlink.*,net.semanlink.util.*, java.util.*, java.io.*"%><%@ taglib uri="http://struts.apache.org/tags-bean" prefix="bean" %><%@ taglib uri="http://struts.apache.org/tags-html" prefix="html" %><%@ taglib uri="http://struts.apache.org/tags-logic" prefix="logic" %><%Jsp_Document jsp = (Jsp_Document) request.getAttribute("net.semanlink.servlet.jsp");SLDocument x = (SLDocument) jsp.getSLResource();String uri = x.getURI();%>        <script>            var files = false;                        window.onload = function() {                var dropbox = document.getElementById("dropbox");                dropbox.addEventListener("dragenter", noop, false);                dropbox.addEventListener("dragexit", noop, false);                dropbox.addEventListener("dragover", noop, false);                dropbox.addEventListener("drop", dropUpload, false);            }            function noop(event) {                event.stopPropagation();                event.preventDefault();            }            function dropUpload(event) {                noop(event);                files = event.dataTransfer.files;                                                var dropbox = document.getElementById("dropbox");                var fns = ""                for (var i = 0; i < files.length; i++) {                    // upload(files[i]);                    fns += files[i].name                    fns += "\n";                }                dropbox.innerHTML = fns;            }            function uploadFiles() {            	if (!files) {            		alert("No file to upload")            	}                for (var i = 0; i < files.length; i++) {                    upload(files[i]);                }            }                        function uploadDirUri() {            	return '<%=uri%>';            }                        function upload(file) {                var type = file.type;                if (!type) {                	alert("Folders not supported");                	return;                } else {                	// alert("type: " + type)                }                document.getElementById("status").innerHTML = "Uploading " + file.name;                var formData = new FormData();                formData.append("uploadDirUri", uploadDirUri());                formData.append("file", file);                // alert(document.getElementById("sub_dir").value);                // formData.append("sub_dir", document.getElementById("sub_dir").value);                var xhr = new XMLHttpRequest();                xhr.upload.addEventListener("progress", uploadProgress, false);                xhr.addEventListener("load", uploadComplete, false);                // 2020-09 TODO                xhr.open("POST", getContextPath() + "/sl/upload", true); // If async=false, then you'll miss progress bar support.                xhr.send(formData);            }            function uploadProgress(event) {                // Note: doesn't work with async=false.                var progress = Math.round(event.loaded / event.total * 100);                document.getElementById("status").innerHTML = "Progress " + progress + "%";            }            function uploadComplete(event) {                // document.getElementById("status").innerHTML = event.target.responseText;                // document.getElementById("dropbox").innerHTML = "Drag and drop a file here..."                window.location.href = '<%=uri%>';            }        </script>        <style>            #dropbox {                /* width: 100%; 300px;*/                height: 20px;                border: 1px solid gray;                border-radius: 5px;                padding: 5px;                color: gray;            }        </style>     <div class="graybox"><div class="what">File Upload</div>        <p></p>        <div id="dropbox">Drag and drop a file here...</div>        <div id="status"></div>        <button onclick="uploadFiles()">Upload</button></div>       <!--/fileupload.jsp-->