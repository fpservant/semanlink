<!--comment.jsp--><%@ page language="java" session="true" import="net.semanlink.servlet.*,net.semanlink.semanlink.*,java.util.*"%><%@ taglib uri="http://struts.apache.org/tags-bean" prefix="bean" %><%@ taglib uri="http://struts.apache.org/tags-html" prefix="html" %><%@ taglib uri="http://struts.apache.org/tags-logic" prefix="logic" %><%Jsp_Resource jsp = (Jsp_Resource) request.getAttribute("net.semanlink.servlet.jsp");boolean edit = (Boolean.TRUE.equals(session.getAttribute("net.semanlink.servlet.edit")));SLResource x = jsp.getSLResource();String uri = x.getURI();String comment = x.getComment();if (comment == null) comment = "";// beware, comment can contain markdown or html (old way of storing formated content in sl:comment)// In both cases the "<" and ">" have been replaced by &lt; and &gt; in the rdf xml// (would it be the same if storing it a turtle?)// They are converted back to "<" and ">" when we receive (that's what we see in JenaUtils.getComment())// et du coup je ne comprens pas comment ça a pu marcher avec du html traditionnel// on faisait un if (!edit) {		// The idea: we put the comment (typically markdown) inside a div,	// and once the page is loaded, js convert the markdown in place.	// pb : markdown may contain <http://www.a.com>    // which cannot be included as such inside a div    // -> either store the comment in a textfield,     // (which requires 2 containers for a comment : raw and formatted)    // or replace here the "<" from the comment before adding it to the div, and     // do the inverse in javascript before converting the markdown with markdonw-it    // Having 2 containers: would not be a problem here, but that's not the same    // when displaying the list of docs    // In old stuff, I was using html inside comments instead of markdwon	// une approximation des cas où c'est du html 	// -- on suppose donc que le md ne pourra pas contenir de html - du moins ces balises	if ((comment != null) && (!("".equals(comment)))) {		comment = jsp.comment4div(comment);// 		boolean itsHtml = Jsp_Resource.isHtmlComment(comment);// 		if (itsHtml) {// 			// old stuff, when I was using html in comments// 			// Leave unchanged// 		} else {// 			comment = comment.replaceAll("<","&lt;"); // HUM BUG s'il y a des &lt; dans comment // TODO (but what?)// 	        // the md is formatted once the page is loaded//             jsp.addOnLoadEvents("displayCommentAsMarkdown");// 		}		// ATTENTION, pas d'espace dans la div		%><div class="graybox"><div id= "slcomment" class="markdown" property="rdfs:comment"><%=comment%></div></div><%	  	} // comment !null} else { // edit	String docorkw;	if (x instanceof net.semanlink.semanlink.SLDocument) {		docorkw = "doc";	} else {		docorkw =  "kw";	}	%>	    <script>    function createCommentEditor() {        var $ = function (id) { return document.getElementById(id); };        new Editor($("slcomment_raw"), $("slcomment_formatted"));    }    </script>		    <%    jsp.addOnLoadEvents("createCommentEditor");    %>    <div class="graybox">          <div class="what"><%=jsp.i18l("x.comment")%></div>	    <div class="graybox"><div id= "slcomment_formatted" class="markdown" property="rdfs:comment"></div></div> 			<html:form action="setcomment">				<html:hidden property="uri" value="<%=uri%>" />				<html:hidden property="docorkw" value="<%=docorkw%>" />				<div class="graybox"><textarea id="slcomment_raw" name="comment" cols="80" rows="5" 				    oninput="this.editor.update()" ><%=comment%></textarea>					<!-- html:hidden property="property" value="comment" / -->					<html:select property="lang">						<html:option value="-">-</html:option>						<html:option value="fr">fr</html:option>						<html:option value="en">en</html:option>						<html:option value="es">es</html:option>						<html:option value="pt">pt</html:option>					</html:select>					<html:submit property="<%=Action_SetOrAddProperty.SET%>"><%=jsp.i18l("x.setComment")%></html:submit>                </div>			</html:form>	</div>		<% // graybox} // edit or not%><!--/comment.jsp-->